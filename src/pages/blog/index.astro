---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import BaseLayout from "../../layouts/BaseLayout.astro";
import EmptyBlogState from "../../components/EmptyBlogState.astro";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title={`Blog - ${SITE_TITLE}`} description={SITE_DESCRIPTION}>
  <main>
    <section
      class="w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-24 sm:py-32"
    >
      {
        posts.length > 0 ? (
          <div class=" text-standard py-24 sm:py-32">
            <div class="mx-auto max-w-7xl px-6 lg:px-8">
              <div class="mx-auto max-w-2xl lg:max-w-4xl">
                <h2 class="text-4xl font-semibold tracking-tight text-pretty text-highlight sm:text-5xl">
                  From the blog
                </h2>
                <p class="mt-2 text-lg/8 text-standard">
                  Learn how to grow your business with our expert advice.
                </p>
                <div class="mt-16 space-y-20 lg:mt-20">
                  {posts.map((post) => (
                    <article class="relative isolate flex flex-col gap-8 lg:flex-row">
                      <div class="relative aspect-video sm:aspect-2/1 lg:aspect-square lg:w-64 lg:shrink-0">
                        {post.data.heroImage ? (
                          <Image
                            width={720}
                            height={360}
                            src={post.data.heroImage}
                            alt={post.data.title}
                            class="absolute inset-0 size-full rounded-2xl bg-tertiary object-cover"
                          />
                        ) : null}
                        <div class="absolute inset-0 rounded-2xl inset-ring inset-ring-highlight/10" />
                      </div>
                      <div>
                        <div class="flex items-center gap-x-4 text-xs">
                          <time
                            datetime={post.data.pubDate.toISOString()}
                            class="text-highlight"
                          >
                            <FormattedDate date={post.data.pubDate} />
                          </time>
                        </div>
                        <div class="group relative max-w-xl">
                          <h3 class="mt-3 text-lg/6 font-semibold text-highlight group-hover:text-highlight-darken">
                            <a href={`/blog/${post.id}/`}>
                              <span class="absolute inset-0" />
                              {post.data.title}
                            </a>
                          </h3>
                          <p class="mt-5 text-sm/6 text-standard">
                            {post.data.description}
                          </p>
                        </div>
                        <div class="mt-6 flex border-t border-highlight/20 pt-6" />
                      </div>
                    </article>
                  ))}
                </div>
              </div>
            </div>
          </div>
        ) : (
          <EmptyBlogState />
        )
      }
    </section>
  </main>
</BaseLayout>
